# Задание к экзамену


* Вариант №1 - ветка /case-01

# Задание 
Итоговая проверочная работа

Демонстрационное задание

Все исполняемые файлы расположены в папке ./bin
Файлы Frontend-приложения расположены в папке ./frontend
!!! ВАЖНОЕ ЗАМЕЧАНИЕ: В выражение map конфигурации NGINX необходимо добавить опцию hostnames;

Пример:

map $http_x_rpc_method $target_service {
   hostnames;

   user.*  user-service;
   default core-service;
}
В Docker Compose нужно сконфигурировать следующую инфраструктуру:
loadbalancer - роутер/балансировщик нагрузки
core-service - контейнер с запущенным сервисом ./bin/core-service
math-service - контейнер с запущенным сервисом ./bin/math-service
!!! ВАЖНОЕ ЗАМЕЧАНИЕ: В Docker файлах сервиса не забывайте использовать команду:

RUN chmod +x /путь/к/исполняемому/файлу
иначе могут быть проблемы с запуском контейнеров в системе Windows.

loadbalancer должен отвечать на запросы по адресу http://127.0.0.1:8080 (внутри контейнера сервис использует порт :80)

Сервисы core-service и math-service должны быть доступны только внутри Compose и принимать подключения на порту :80

Запрос по адресу http://127.0.0.1:8080 должен возвращать стартовую страницу frontend приложения. Файлы веб приложения расположены в папке ./frontend. Необходимо смонтировать эту папку в контейнер и настроить правило маршрутизации для location /

Запросы по адресу http://127.0.0.1:8080/rpc должны возвращать результаты вызовов к микросервисам core-service и math-service

Правила RPC протокола:

Максимальный размер пакета - 64 байт
Время выполнения запроса - 1 секунда
Запросы только методом POST (ошибка: 405)
В запросе должны присутствовать следующие заголовки:
X-Client-ID: sirius-frontend (ошибка: 401)
X-Client-Secret: <любая строка> (ошибка: 401)
X-Rpc-Method: <math.*> (ошибка: 400)
Тело запроса должно приходить в формате JSON (ошибка: 400)
Правила маршрутизации запросов для location /rpc

Все запросы удовлетворяющие правилу math.* проксируются в сервис math-service
Все остальные запросы просируются в core-service
Правила RPC запросов: math-service выполняет следующие функции:

math.sum - сложение
math.sub - вычитание
math.mult - умножение
math.div - целочисленное деление
В теле запроса необходимо отправить данные в формате JSON:

{
   "a": 20,
   "b": 10
}
Ответ сервера на запрос с заголовком X-Rpc-Method: math.sum

{
   "result": 30
}